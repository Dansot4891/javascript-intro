<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
</head>
<body>
    <div class="container">
        <div class="row">
        </div>
    </div>

    <div class="container" style="margin-top: 20px;">
        <button id="add-btn" class="btn btn-danger">더보기</button>
        <button id="sort-btn" class="btn btn-danger">가격순</button>
        <button id="filter-btn" class="btn btn-danger">6만원 이하</button>
    </div>

        <script>
        var products = [
            { id : 0, price : 70000, title : 'Blossom Dress' },
            { id : 1, price : 50000, title : 'Springfield Shirt' },
            { id : 2, price : 60000, title : 'Black Monastery' }
        ];

        // 데이터 추가
        function addProducts(dataSet){
            dataSet.sort(function(a, b){
                return a.price - b.price;
            })
            dataSet.forEach((data) => {
                document.querySelector('.row').innerHTML += `
                        <div class="col-sm-4">
                            <img src="https://placehold.co/600" class="w-100">
                            <h5>${data.title}</h5>
                            <p id="price">가격 : ${data.price}</p>
                            <button id="${data.id}" class="btn btn-danger">구매</button>
                        </div>
                ` 
            });    
        }

        // 리셋후 변수기반 refetch
        function refetch(dataSet){
            document.querySelector('.row').innerHTML = '';
            addProducts(dataSet)
        }

        addProducts(products);
        </script> 

        <script>
            let count = 0;
            const url1 = 'https://codingapple1.github.io/js/more1.json';
            const url2 = 'https://codingapple1.github.io/js/more2.json';
            
            // 데이터 추가 조회
            document.getElementById('add-btn').addEventListener('click', async function() {
                let url = url1;
                if(count == 1){
                    url = url2;
                }
                let dataSet = await fetchProducts(url);
                addProducts(dataSet);
                count++;
                if(count > 1) {
                    document.getElementById('add-btn').style.display = 'none';
                }
            });

            // 가격순으로 sort
            document.getElementById('sort-btn').addEventListener('click', function() {
                products.sort(function(a,b){
                    return a.price - b.price;
                })
                
                refetch(products);
            });

            // 6만원이하 필터링
            document.getElementById('filter-btn').addEventListener('click', function() {
                let newProducts = products.filter(function(a){
                    return a.price < 60000;
                })
                
                refetch(newProducts);
            });

            // 6만원이하 필터링
            document.getElementById('purchase-btn').addEventListener('click', function() {
                
            });
            
            /// url을 변수로 받아 서버로부터 데이터 조회
            async function fetchProducts(url){
                let result = await fetch(url).then((res) => res.json()).then((p) => p).catch((e) => console.log(e));
                products.push(...result); // ✅ 스프레드 연산자로 개별 항목들 추가
                return result;
            }

            var arr = [1,2,3]
            var newArr = JSON.stringify(arr);

            localStorage.setItem('이름', '임명우');
            localStorage.setItem('newArr', newArr);

            var nnArr = localStorage.getItem('newArr');

            sessionStorage.setItem('이름', '임명우');
            sessionStorage.setItem('newArr', newArr);

            var nnArr = localStorage.getItem('newArr');

            console.log(JSON.parse(nnArr)[0]);
        </script>
</body>
</html>