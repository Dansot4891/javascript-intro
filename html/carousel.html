<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="/css/carousel.css" rel="stylesheet">
</head>
<body>
    <div style="overflow: hidden;">
        <div class="slide-container">
            <div class="slide-box">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQlmG8urG-D59HXwkFZO-vp31_K8dwXwlQfJA&s">
            </div>
            <div class="slide-box">
                <img src="https://www.hyundai.com/contents/repn-car/side-45/main-avante-hybrid-26my-45side.png">
            </div>
            <div class="slide-box">
                <img src="https://file2.nocutnews.co.kr/newsroom/image/2016/04/19/20160419094446609126.jpg">
            </div>
        </div>
    </div>

    <button class="slide-1">1</button>
    <button class="slide-2">2</button>
    <button class="slide-3">3</button>
    <br>
    <button class="previous">이전</button>
    <button class="next">다음</button>

    <script>
        const slider = document.querySelector('.slide-container');
        const slides = document.querySelectorAll('.slide-box');
        const len = slides.length;

        let current = 0;          // 현재 인덱스
        let baseX = 0;            // 현재 인덱스의 기준 위치(px)
        let startX = 0;           // 드래그 시작 좌표
        let deltaX = 0;           // 이동량
        let dragging = false;

        function snap(i){
            current = Math.max(0, Math.min(i, len-1));
            baseX = -current * window.innerWidth;
            slider.style.transition = 'transform .3s ease';
            slider.style.transform = `translateX(${baseX}px)`;
        }

        // 초기 위치
        snap(0);

        // 버튼
        document.querySelector('.slide-1').onclick = ()=>snap(0);
        document.querySelector('.slide-2').onclick = ()=>snap(1);
        document.querySelector('.slide-3').onclick = ()=>snap(2);
        document.querySelector('.previous').onclick = ()=>snap(current-1);
        document.querySelector('.next').onclick = ()=>snap(current+1);

        // 공용 핸들러 (mouse + touch)
        const getX = e => (e.touches ? e.touches[0].clientX : e.clientX);

        function onDown(e){
            dragging = true;
            startX = getX(e);
            deltaX = 0;
            slider.style.transition = 'none';
            // 기준 위치는 현재 스냅된 baseX 사용
            e.preventDefault(); // 이미지 기본 드래그 방지
        }

        function onMove(e){
            if(!dragging) return;
            deltaX = getX(e) - startX;
            slider.style.transform = `translateX(${baseX + deltaX}px)`;
        }

        function onUp(){
            if(!dragging) return;
            dragging = false;
            const threshold = window.innerWidth * 0.15; // 15% 넘게 끌면 페이지 전환
            if(deltaX >  threshold) snap(current-1);
            else if(deltaX < -threshold) snap(current+1);
            else snap(current); // 원위치
        }

        // 컨테이너에만 이벤트 (개별 .slide-box에 걸 필요 없음)
        slider.addEventListener('mousedown', onDown);
        window.addEventListener('mousemove', onMove);
        window.addEventListener('mouseup', onUp);

        // 터치 지원
        slider.addEventListener('touchstart', onDown, {passive:false});
        window.addEventListener('touchmove', onMove, {passive:false});
        window.addEventListener('touchend', onUp);
    </script>
</body>
</html>